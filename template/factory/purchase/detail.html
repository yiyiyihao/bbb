<form method="post" class="form-x admin-form form-auto" id="form">
    <div class="tab admin-tab">
        <div class="panel admin-box fixed-pannel active">
            <div class="panel-head">
                <div class="tab-head">
                    <strong class="icon-detail"> {$info['name'] ?? ''}</strong>
                </div>
            </div>
            <div class="tab-body">
                <div class="tab-panel active" id="tab-1">
                	<div class="goodsInfo clearfix">
                        <div class="goodsPicBox float-left">
                            <span class="jqzoom clearfix" rel="gal1" title="{$info['name'] ?? ''}"><img src="{$info.thumb}" class="zoomImg" jqimg="{$info.thumb_big}" width="348"  height="348"/></span>
                            <div id="thumblist" class="clearfix">
                            {volist name="info.imgs" id="vo"}
                                <a {eq name="i" value="1"}class="zoomThumbActive"{/eq} href='javascript:void(0);' rel="{gallery: 'gal1', smallimage: '{$vo.thumb}',largeimage: '{$vo.thumb_big}'}"><img src="{$vo.thumb}" width="58"></a>
                            {/volist}
                            </div>       		
                        </div>
                        
                        <div class="goodsText">
                            <h3 class="goodsTitle">{$info.name}</h3>
                            <p class="subTitle">{$info.description}</p>
                            <div class="priceBox">
                                <p><b>价格</b><span id="price" class="text-main">￥<i id="salePrice">{$info.min_price}</i></span></p>
                            </div>
                            <div class="specBox">
                                <p><b>库存</b><span>{$info.goods_stock}</span></p>
                                <p class="clearfix"><b>数量</b>
                                    <span class="nums_item">
                                        <span class="nums_btn float-left icon-minus bg-main" type="del"></span><input  class="nums float-left border-main" type="number" value="1" /><span class="nums_btn float-left icon-plus bg-main" type="add"></span>
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                	<!--
                    <div class="form-group">
                        <div class="label">
                            <label>产品价格</label>
                        </div>
                        <div class="field">
                        	<div class="field-text">
                            	<p>{$info['min_price'] + $info['install_price']} 元</p>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>产品类型</label>
                        </div>
                        <div class="field">
                        	<div class="field-text">
                            	<p>{$info.goods_type == 1 ? '普通商品' : '样品'}</p>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label></label>
                        </div>
                        <div class="field">                        
                        {notempty name="skus"}
                        <div class="table-responsive" style="padding:0;">
                            <table id="table" class="table table-hover ">
                              <tbody>
                                <tr>
                                  <th width="*">属性名称</th>
                                  <th width="*">属性货号</th>
                                  <th width="*">库存</th>
                                  <th width="*">价格</th>
                                  <th width="*"></th>
                                </tr>
                                  {volist name="skus" id="vo"}
                                    <tr>
                                      <td>{$vo.sku_name}</td>
                                      <td>{$vo.sku_sn}</td>
                                      <td>{$vo.sku_stock}</td>
                                      <td>{$vo['install_price'] + $vo['price']}元</td>
                                      <td><a href="{:url('confirm', ['sku_id' => $vo['sku_id'], 'num' => 1])}" class="button button-small bg-yellow">立即购买</a></td>
                                    </tr>
                                  {/volist}
                              </tbody>
                            </table>
                          </div>
                          {/notempty}
                        </div>
                    </div>
                    -->
                </div>
            </div>
            <div class="panel-foot">
                <div class="form-button" style="margin-left:385px;">
                	{notempty name="$info['sku_id']"}
                    <!--<a href="{:url('confirm', ['sku_id' => $info['sku_id'], 'num' => 1])}" class="button button-small bg-yellow">立即购买</a>-->
                    {/notempty}
                    <div class="button bg-main buy_btn">进货下单</div> <div class="button bg-dot"> 返回</div>
                </div>
            </div>
        </div>
    </div>
</form>
<script>
    Do.ready('base', function () {
        //表单综合处理
        $('#form').FormPage();  
    }); 
</script>
<script type="text/javascript">
var action = "buy";
var goods_id = "<?php echo $info['goods_id'] ?>";
var goods_total = "<?php echo $info['goods_stock'] ?>"; //库存
$(function(){
	$(".jqzoom").jqzoom({
		zoomType: 'standard',
		lens:true,
		preloadImages: false,
		alwaysOn:false,
		zoomWidth:450,
		zoomHeight:450
	});
	//加入购物车
	$(".cart_btn").on("click",function(){
		if($.trim(_UID_)==''){
			window.location.href = "/login?url_forward=/goods/info/id/"+goods_id;
			return;
		}
		action = "cart";
		var nums = $(".nums").val();
		if($.trim(goods_id)==0){
	     	layer.alert("购买商品不存在");
			return;
		}
		if($.trim(nums)<=0){
	     	layer.alert("购买商品数量不能小于1");
			return;
		}
		cart.add(goods_id,nums,action,add_cart_callback);
	});
	//立即购买
	$(".buy_btn").on("click",function(){
		if($.trim(_UID_)==''){
			window.location.href = "/login?url_forward=/goods/info/id/"+goods_id;
			return;
		}
		action = "buy";
		var nums = $(".nums").val();
		if($.trim(goods_id)==0){
	     	layer.alert("购买商品不存在");
			return;
		}
		if($.trim(nums)<=0){
	     	layer.alert("购买商品数量不能小于1");
			return;
		}
		layer.msg("加入购物车成功,正在下单……",{icon:6,time:4000});
		cart.add(goods_id,nums,action,add_cart_callback);
	});
	//加入购物车回调
	var add_cart_callback = function(res){
		get_total();
		if(action=='buy'){ 	//buy:立即购买，cart:加入购物车
			setTimeout(function(){
				window.location.href = '/settlement/index?goods_id='+goods_id;
			},3000);
		}else {
			layer.msg(res.message);
		}
	}


	//修改数量
	$(".nums_btn").on("click",function(){
		var nums = $(".nums").val();
		var type = $(this).attr("type"); //add:增加，del:减少
		if(type=="add") nums++;
		else nums--;
		if(nums <= 0) nums = 1;
		else if(nums > goods_total) nums = goods_total;
		$(".nums").val(nums);
	});

	//get_total();
});

function get_total(){
	cart.total(function(res){
		$(".to_cart em").html(res.total_nums);
	}); 
}

</script>