<form method="post" class="form-x admin-form form-auto" id="form">
    <div class="tab admin-tab">
        <div class="panel admin-box active">
            <div class="panel-head">
                <div class="tab-head">
                    <ul class="tab-nav">
                        <li class="active"><a href="#tab-1">订单信息信息</a></li>
                        <li class=""><a href="#tab-3">订单操作日志</a></li>
                    </ul>
                </div>
            </div>
            <div class="tab-body">
                <div class="tab-panel active" id="tab-1">
                	<div class="table-responsive">
					    <table id="table" class="table table-hover ">
					      <tbody>
					        <tr>
					        	<th width="80">编号</th>
					        	<th width="100">产品类型</th>
					          <th width="*">产品名称</th>
					          <th width="100">产品图片</th>
					          <th width="80">单价</th>
					          <th width="80">购买数量</th>
					          <th width="80">支付金额</th>
					          <th width="120">安装状态</th>
					          <th width="120">退货退款状态</th>
					          <th width="*">物流信息</th>
					          <th width="*">操作</th>
					        </tr>
					        {notempty name="info.order.skus"}
					          {volist name="info.order.skus" id="vo"}
					            <tr>
					             <td>{$i}</td>
					             <td>{:goodstype($vo.goods_type)}</td>
					              <td>{$vo.sku_name} {$vo.sku_spec}</td>
					              <td><img src="{$vo.sku_thumb|default='/static/base/images/default.png'}" id="preview_imgs" width="100"></td>
					              <td>{$vo.price}元</td>
					              <td>{$vo['num']}</td>
					              <td>{$vo.real_price}元</td>
					              <td>-</td>
					              <td>-</td>
					              <td>-</td>
					              <td>
					              	<span class='button-group'>
					              	{if condition="$info['order']['order_type'] != 1"}
						              	{if condition="$vo['delivery_status'] != 0 AND $vo['odelivery_id'] != 0"}
						                <a href="{:url('deliveryLogs', ['odelivery_id' => $vo['odelivery_id']])}" class="button button-small bg-red js-open" title="查看物流">查看物流</a>
						                {/if}
					                {/if}
					              	</span>
					              </td>
					            </tr>
					            {notempty name="vo"}
						          {volist name="vo.subs" id="v" key='k'}
						            <tr>
						              <td>|-{$k}</td>
						              <td colspan="3"></td>
						              <td>{$v.price}元</td>
						              <td>1</td>
						              <td>{$v.real_price}元</td>
						              <td>
						              	{if condition="$vo.goods_type != 2"}
						              	{if ($info['order']['pay_status'] == 1 && $v.work_order)}
						              		{:get_work_order_status($v.work_order.work_order_status)}
						              	{/if}
						              	{else/}
						              		样品不安装
						              	{/if}
						              </td>
						              <td>{:get_service_status($v.service.service_status)}</td>
						              <td>{$v.delivery_name}<br>{$v.delivery_sn}</td>
						              <td>
						              	{if condition="$vo.goods_type != 2"}
						              		{if condition="(!$v.service || $v.service.service_status == -2) && $info['order']['pay_status'] == 1 && (!$v.work_order || $v.work_order.work_order_status == -1)"}
							              		<a href="{:url('workorder/add', ['ossub_id' => $v['ossub_id'], 'type' => 1])}" class="button button-small bg-red js-open" title="申请安装">申请安装</a>
							              	{elseif ($v.work_order)/}
							              		<a href="{:url('workorder/detail', ['id' => $v.work_order.worder_id])}" class="button button-small bg-red js-open" title="查看安装工单">查看安装工单</a>
							              	{/if}
						              	{/if}
						              	{if condition="(!$v.work_order || $v.work_order['work_order_status'] == -1) && $info['order']['close_refund_status'] == 0 && $info['order']['pay_status'] == 1 && (!$v.service || $v.service.service_status == -2)"}
						              		<a href="{:url('return', ['order_sn' => $vo['order_sn'], 'ossub_id' => $v['ossub_id']])}" class="button button-small bg-yellow js-open" title="申请退货退款">申请退货退款</a>
						              	{elseif ($v.service)/}
						              		{if ($v.service.service_status == -2 || $v.service.service_status == -1)}
						              		<a href="{:url('return', ['order_sn' => $vo['order_sn'], 'ossub_id' => $v['ossub_id'], 'sid' => $v.service.service_id])}" class="button button-small bg-yellow js-open" title="重新申请退货退款">重新申请退货退款</a>
						              		{elseif ($v.service.service_status == 1)/}
						              		<a href="{:url('service/delivery', ['id' => $v.service.service_id])}" class="button button-small bg-yellow js-open" title="填写退货信息">填写退货信息</a>
						              		{else/}
						              		<a href="{:url('service/detail', ['id' => $v.service.service_id])}" class="button button-small bg-yellow js-open" title="查看退货退款">查看退货退款</a>
						              		{/if}
						              	{/if}
						              </td>
						            </tr>
						          {/volist}
						        {/notempty}
					          {/volist}
					        {/notempty}
					      </tbody>
					    </table>
					  </div>
                    <div class="form-group">
                        <div class="label">
                            <label>订单号</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['order_sn'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>订单状态</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['_status']['status_text'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>支付方式</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['_pay_status']['name'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>第三方交易号</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['pay_sn'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>下单账号</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['user']['nickname'] ? $info['user']['nickname']: $info['user']['username']}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>下单时间</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['add_time']|date='Y-m-d H:i:s'}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>支付时间</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{if condition='$info["order"]["pay_time"]'}{$info['order']['pay_time']|date='Y-m-d H:i:s'}{/if}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>产品总价</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['goods_amount'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>安装费用</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['install_amount'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>物流费用</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['delivery_amount'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>订单总价</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['real_amount'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>收货人姓名</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['address_name'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>收货人电话</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['address_phone'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>收货地址</label>
                        </div>
                        <div class="field">
                            <input type="text" disabled="disabled" class="input" size="40" value="{$info['order']['address_detail'] ?? ''}">
                        </div>
                    </div>
                    <div class="form-group">
			            <div class="label">
			              <label>订单留言</label>
			            </div>
			            <div class="field">
			              <textarea class="input" id="remark" disabled="disabled" name="remark" rows="5" cols="60">{$info['order']['remark'] ?? ''}</textarea>
			            </div>
			          </div>  
                </div>
            	<div class="tab-panel" id="tab-3">
            		<div class="table-responsive">
					    <table id="table" class="table table-hover ">
					      <tbody>
					        <tr>
					          <th width="80">编号</th>
					          <th width="*">操作用户</th>
					          <th width="*">操作</th>
					          <th width="*">操作备注</th>
					          <th width="*">操作时间</th>
					        </tr>
					        {notempty name="info.logs"}
					          {volist name="info.logs" id="vo"}
					            <tr>
					              <td>{$i}</td>
					              <td>{$vo.nickname}</td>
					              <td>{$vo.action}</td>
					              <td>{$vo.msg}</td>
					              <td>{$vo['add_time']|date='Y-m-d H:i:s'}</td>
					            </tr>
					          {/volist}
					        {/notempty}
					      </tbody>
					    </table>
					  </div>
            	</div>
            </div>
            <div class="panel-foot">
                <div class="form-button">
                    <a href="{:url('index')}" class="button button-middle bg-main">返回列表</a>
                </div>
            </div>
        </div>
    </div>
</form>
