<div class="line-big col-space15">
	<div class="xm12">
    	<div class="panel admin-dashboard boxShadow">
        	<div class="panel-body clearfix">
            	<div class="xm3">
                	<div class="num-item-box col-box">
                        <h4>今日支付订单数量</h4>
                        <div class="item-num">{$today.order_count}</div>
                    </div>
                </div>
                <div class="xm3">
                	<div class="num-item-box col-box">
                        <h4>今日支付订单金额</h4>
                        <div class="item-num">￥{$today.order_amount}</div>
                    </div>
                </div>
                <div class="xm3 hide">
                    <div class="num-item-box col-box">
                        <h4>累计成功退款订单数</h4>
                        <div class="item-num">{$total.refund_count|default=0}</div>
                    </div>
                </div>
                <div class="xm3">
                	<div class="num-item-box col-box">
                        <h4>今日新增零售商数</h4>
                        <div class="item-num">{$today.dealer_count}</div>
                    </div>  
                </div>
                <div class="xm3">
                	<div class="num-item-box col-box">
                        <h4>累计支付订单数量</h4>
                        <div class="item-num">{$total.order_count}</div>
                    </div>
                </div>
                <div class="xm3">
                	<div class="num-item-box col-box">
                        <h4>累计支付订单金额</h4>
                        <div class="item-num">￥{$total.order_amount}</div>
                    </div>
                </div>
                <div class="xm3 hide">
                    <div class="num-item-box col-box">
                        <h4>累计成功退款金额</h4>
                        <div class="item-num">￥{$total.refund_amount|default=0}</div>
                    </div>
                </div>
                <div class="xm3">
                	<div class="num-item-box col-box">
                        <h4>零售商总数</h4>
                        <div class="item-num">{$total.dealer_count}</div>
                    </div> 
                </div>
                <div class="xm3 hide">
                	<div class="num-item-box col-box">
                        <h4>渠道商总数</h4>
                        <div class="item-num">{$total.channel_count}</div>
                    </div>
                </div>
                <div class="xm3">
                	<div class="num-item-box col-box">
                        <h4>服务商总数</h4>
                        <div class="item-num">{$total.service_count}</div>
                    </div>
                </div>                
                <div class="xm3">
                	<div class="num-item-box col-box">
                   		<h4>售后工程师总数</h4>
                       	<div class="item-num">{$total.installer_count}</div>
                   	</div> 
                </div>
            </div>
        </div>
    </div>
    <div class="xm12">
    	<div class="line-big col-space15">
            <div class="xm12">
                <div class="panel admin-dashboard boxShadow">
                    <div class="panel-head"><span>工单概况</span></div>
                    <div class="panel-body">
                       <div class="panel-block flex-container">
                       		<div class="flex-item num-item-box">
                            	<h4>今日提交安装工单数量</h4>
                                <div class="item-num">{$today.post_count_1}</div>
                            </div>  
                            <div class="flex-item num-item-box">
                            	<h4>今日上门安装工单数量</h4>
                                <div class="item-num">{$today.sign_count_1}</div>
                            </div>
                            <div class="flex-item num-item-box">
                            	<h4>今日提交维修工单数量</h4>
                                <div class="item-num">{$today.post_count_2}</div>
                            </div>  
                            <div class="flex-item num-item-box">
                            	<h4>今日上门维修工单数量</h4>
                                <div class="item-num">{$today.sign_count_2}</div>
                            </div>    
                       </div>
                       <div class="panel-block flex-container">
                       		<div class="flex-item num-item-box">
                            	<h4>累计提交安装工单数量</h4>
                                <div class="item-num">{$total.post_count_1}</div>
                            </div>  
                            <div class="flex-item num-item-box">
                            	<h4>累计上门安装工单数量</h4>
                                <div class="item-num">{$total.sign_count_1}</div>
                            </div>                            
                            <div class="flex-item num-item-box">
                            	<h4>累计提交维修工单数量</h4>
                                <div class="item-num">{$total.post_count_2}</div>
                            </div>  
                            <div class="flex-item num-item-box">
                            	<h4>累计上门维修工单数量</h4>
                                <div class="item-num">{$total.sign_count_2}</div>
                            </div>  
                       </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
	<div class="xm12">
    	<div class="line-big col-space15">
            <div class="xm12">
                <div class="panel admin-dashboard boxShadow">
                    <div class="panel-head"><span>财务概况</span></div>
                    <div class="panel-body">
                       <div class="panel-block flex-container">
                       		<div class="flex-item num-item-box">
                            	<h4>累计保证金金额</h4>
                                <div class="item-num">￥{$total.security_money_total}</div>
                            </div>                            
                            <div class="flex-item num-item-box hide">
                            	<h4>渠道商累计成功提现金额</h4>
                                <div class="item-num">￥{$total.channel_withdraw_amount}</div>
                            </div>
                            <div class="flex-item num-item-box">
                            	<h4>服务商累计成功提现金额</h4>
                                <div class="item-num">￥{$total.servicer_withdraw_amount}</div>
                            </div>
                       </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="xm12">
    	<div class="panel admin-dashboard boxShadow">
            <div class="panel-head"><span>订单概况</span><div class="float-right button-group" data-type="1"><span class="button button-small" data-type="1">今日</span><span class="button button-small bg-main" data-type="7">7天</span><span class="button button-small" data-type="30">30天</span></div></div>
            <div class="panel-body">
            	<div class="js-chart" id="orderChart" style="height:400px;" data-chart='{$chart_overview|default=""}'></div>
            </div>
        </div>
    </div>
    <div class="xm12">
        <div class="panel admin-dashboard boxShadow">
            <div class="panel-head"><span>订单金额统计</span><div class="float-right button-group" data-type="0"><span class="button button-small" data-type="1">今日</span><span class="button button-small bg-main" data-type="7">7天</span><span class="button button-small" data-type="30">30天</span></div></div>
            <div class="panel-body">
                <div class="js-chart" id="chart_amount" style="height:400px;" data-chart='{$chart_amount|default=""}'></div>
            </div>
        </div>
    </div>

    <div class="xm12">
        <div class="panel admin-dashboard boxShadow clear">
            <div class="panel-head"><span>服务统计</span>
                <div class="float-right button-group" data-type="2">
                    <span class="button-small">
                        <select class="input" id="service_id"  style="height: 30px;padding: 0px;">
                            <option value="0">全部</option>
                            {notempty name="service"}
                            {volist name="service" id="vo" key="key"}
                            <option value="{$vo.store_id?? ''}">{$vo.name?? ''}</option>
                            {/volist}
                            {/notempty}
                        </select>
                    </span>
                    <span class="button button-small bg-main no-select" data-type="7">7天</span>
                    <span class="button button-small no-select" data-type="30">30天</span>
                    <span class="button button-small no-select" data-type="365">近1年</span>
                </div>
            </div>
            <div class="panel-body clearfix">
                <div class="xm6">
                    <div class="num-item-box">
                        <h4></h4>
                        <div class="item-num">

                            <div class="js-chart" id="worker-assess" data-chart='{$worder_assess|raw|default=""}' style="width: 600px;height:400px;"></div>
                        </div>
                    </div>
                </div>
                <div class="xm6">
                    <div class="num-item-box clear">
                        <h4><span class="float-right"  id="score-rule">综合评分规则</span></h4>
                        <div class="item-num">
                            <div class="js-chart" id="assess-score" data-chart='{$worder_score|raw|default=""}' style="width: 600px;height:400px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{php}
$today = date('Y-m-d');
//1天
$day_start = $today;
//1个星期
$week_start= date('Y-m-d',strtotime($today.' -6 day'));
//1个月
$month_start=date('Y-m-d',strtotime($today.' -29 day'));
//近1年
$year_start=date('Y-m-d',strtotime($today.' -365 day'));
{/php}

<div class="score-rule">
    <h3>综合评分规则</h3>
    <p>综合评分由消费者填写的对于服务工程师的（安装/维修）工单服务评价统计而来，具体规则如下：</p>
    <p>1、解决率=(已解决工单数 &divide; 总工单数）&times;5;</p>
    <p>2、综合评分=业务能力平均分&times;25%+处理速度平均分&times;25%+服务态度平均分&times;25%+解决率&times;25%</p>
</div>

<script>
$(function(){
    Do.ready('dialog', function () {
        $('#score-rule').click(function () {
            layer.open({
                type: 1,
                shade: false,
                title: false, //不显示标题
                content: $('.score-rule'), //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
            });
        });
        $('#service_id').change(function (e) {
            var btns=$(this).parent('.button-small').siblings('.button-small');
            btns.each(function () {
                if ($(this).hasClass('bg-main')) {
                    $(this).trigger("click");
                    $(this).click();
                    return true;
                }
            });
        });
    });
    

    
	$(".panel-head .button-group .button").click(function(){
		var group = $(this).parent();
		var chartType = group.data("type");
        group.find(".bg-main").removeClass("bg-main");
        $(this).addClass("bg-main");
        var days = $(this).data("type");
        getChartData(chartType,days);
	})
	//异步取得图表数据
	function getChartData(chartType,days){
		//异步获取数据
    	var url = "/index/chart_data";
		var start = '';
		var end   = '{$today}';
		//一周内的数据,type:1 订单概况，0订单金额，非当天数据有缓存
		switch(days){
			case 1://获取当天数据
			start = '{$day_start}';
			break;
			case 7://获取一周数据
			start = '{$week_start}';
			break;
			case 30://获取一月数据
			start = '{$month_start}';
			break;
            case 365:
                start = '{$year_start}';
                break;
		}
		var data = {start:start,end:end,type:chartType};
        if (chartType == 2) {
            data.store_id=$('#service_id').val();
        }
		//1个月数据，type:1 订单概况，0订单金额，非当天数据有缓存
		$.post(url , data ,function(e){
			var id = '';
			switch(chartType){
				case 0:
				id = 'chart_amount';
				break;
				case 1:
				id = 'orderChart';
				break;
                case 2:
                    var assess=$('#worker-assess');
                    assess.data("chart",e.assess);
                    assess.EChartNew();
                    if (e.assess_score) {
                        var score=$('#assess-score');
                        score.data("chart",e.assess_score);
                        score.EChartNew();
                    }
                    return true;
			}
			$("#"+id).data("chart",e);
			$("#"+id).EChartNew();
		});
	}
})
    
    
</script>