<script>
$(function(){
	//建立WebSocket通讯
	var socket = new WebSocket("ws://{$Think.config.websocket_ip}:8282");
	//连接成功时触发
	socket.onopen = function(){
		var login_data = '{$loginData|raw|default=""}';
		socket.send(login_data);
	};
	//监听收到的消息
	socket.onmessage = function(res){
		if(typeof res.data=='object'){
			var data = res.data;
		}else{
			var data = eval("("+res.data+")");
		}
		if(data.type === 'chatMessage'){
			
		}
		if(data.type === 'sysPush'){	
		
		}
		if(data.type === 'say'){			
			console.log(data.message);
		}
		if(data.type === 'login'){
			//获取当前登陆的客户端id
			var fromId = data.client_id;
		}
	};
	socket.onerror = function(e) {
		  console.log(e);
    };
})
</script>
</body>
</html>
{notempty name="specialBulletins"}
<script>
Do.ready('dialog', function () {
	{present name="specialBulletin"}
	layer.open({
	  type: 1,
	  title: false,
	  area: ['600px', '400px'], //宽高
	  content: '<div class="admin-main">{$specialBulletin.content|raw}</div>',
	  btn: ['已读','关闭'],
	  yes: function(index, layero){
		  var url = "{:url('/Bulletin/read',['id'=>$specialBulletin.bulletin_id])}";
		  $.post(url,function(data){
			if(data.code == 1){
				layer.closeAll();
			}
			layer.msg(data.msg);
		  })
	  },btn2: function(index, layero){
		  layero.close;
	  }
	});
	{else}
	layer.tab({
	  //title: '公告提示',
	  area: ['600px', '400px'],
	  tab: [
	  {volist name="specialBulletins" key="k" id="vo"}
	  {
		title: '公告{$k}', 
		content: "{:url('/bulletin/detail',['id'=>$vo.bulletin_id])}"
	  },
	  {/volist}
	  ]
	});
	{/present}
});
</script>
{/notempty}