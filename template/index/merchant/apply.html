<form method="post" class="form-x admin-form form-auto" id="form">
    <div class="tab admin-tab">
        <div class="panel fixed-pannel admin-box active">
        	<div class="panel-head">
                <div class="tab-head">
                    <ul class="tab-nav">
                        <li class="active"><a class="tab-1" href="#tab-1">选择类型</a></li>
                        <li><a class="tab-2" href="#tab-2">填写资料</a></li>
                        <li><a class="tab-3" href="#tab-3">注册账号</a></li>
                    </ul>
                </div>
            </div>
            <div class="tab-body">
				<div class="tab-panel active" id="tab-1">
                    <div class="form-group">
                        <div class="label">
                            <label>商户类型</label>
                        </div>
                        <div class="field">
                            <div class="button-group radio">
                            {volist name="types" id="type"}
                                <label class='button {if ($i == 1 )}active{/if}'>
                                	<input name="type" value="{$key}" {if ($i == 1)}checked="checked"{/if} type="radio">
                                	<span>{$type['name']}</span>
                                </label>
                            {/volist}
                            </div>
                            <div class="input-note">请选择产品类别</div>
                        </div>
                    </div>
				</div>
				<div class="tab-panel" id="tab-2">
                    <div class="form-group">
                        <div class="label">
                            <label><span id="merchant_type">零售商</span>名称*</label>
                        </div>
                        <div class="field">
                            <input type="text" class="input" id="name" name="name" size="40" datatype="*" value="">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>联系人姓名*</label>
                        </div>
                        <div class="field">
                            <input type="text" class="input" id="user_name" name="user_name" size="40" datatype="*" value="">
                        </div>
                    </div>
                    <div class="form-group type3">
                        <div class="label">
                            <label>渠道商编号*</label>
                        </div>
                        <div class="field">
                            <input type="text" class="input" id="channel_no" name="channel_no" size="40" value="">
                        </div>
                    </div>
                    <div class="form-group type3">
                        <div class="label">
                            <label>采购样品金额</label>
                        </div>
                        <div class="field">
                            <input type="text" class="input" name="sample_amount" size="40" value="">
                        </div>
                    </div>
                    <div class="form-group hidetype3 hide">
                        <div class="label">
                            <label>缴纳保证金金额</label>
                        </div>
                        <div class="field">
                            <input type="text" class="input" name="security_money" size="40" value="">
                        </div>
                    </div>
                    <div class="form-group">
						<div class="label">
							<label>公司法人身份证照片</label>
						</div>
						<div class="field">
							<div style="display: inline-block;">
								<input type="hidden" class="input" id="idcard_font_img" name="idcard_font_img" size="38" value="">
				                <div class="idcard_font_img_preview" style="margin-bottom:10px;"><img src="/static/base/images/default.png" id="idcard_font_img_preview" width="120"></div>
				                <a class="button bg-main button-small js-img-upload" data="idcard_font_img" preview="idcard_font_img_preview" href="javascript:;" >
				                	<span class="icon-upload"> 上传正面</span>
				                </a>
							</div>
			                <div style="display: inline-block;" class="margin-left">
			                	<input type="hidden" class="input" id="idcard_back_img" name="idcard_back_img" size="38" value="">
				                <div class="idcard_back_img_preview" style="margin-bottom:10px;"><img src="/static/base/images/default.png" id="idcard_back_img_preview" width="120"></div>
				                <a class="button bg-main button-small js-img-upload" data="idcard_back_img" preview="idcard_back_img_preview" href="javascript:;" >
				                	<span class="icon-upload"> 上传背面</span>
				                </a>
			                </div>
						</div>
					</div>
					<div class="form-group">
						<div class="label">
							<label>签约合同 (带有双方公司名称)</label>
						</div>
						<div class="field">
		                	<input type="hidden" class="input" id="signing_contract_img" name="signing_contract_img" size="38" value="">
			                <div class="signing_contract_img_preview" style="margin-bottom:10px;"><img src="/static/base/images/default.png" id="signing_contract_img_preview" width="120"></div>
			                <a class="button bg-main button-small js-img-upload" data="signing_contract_img" preview="signing_contract_img_preview" href="javascript:;" >
			                	<span class="icon-upload"> 上传签约合同</span>
			                </a>
						</div>
					</div>
					<div class="form-group hidetype3 hide">
						<div class="label">
							<label>公司营业执照</label>
						</div>
						<div class="field">
		                	<input type="hidden" class="input" id="license_img" name="license_img" size="38" value="">
			                <div class="license_img_preview" style="margin-bottom:10px;"><img src="/static/base/images/default.png" id="license_img_preview" width="120"></div>
			                <a class="button bg-main button-small js-img-upload" data="license_img" preview="license_img_preview" href="javascript:;" >
			                	<span class="icon-upload"> 上传公司营业执照</span>
			                </a>
						</div>
					</div>
					<div class="form-group hidetype3 hide">
						<div class="label">
							<label>签约合影照片</label>
						</div>
						<div class="field">
		                	<input type="hidden" class="input" id="group_photo" name="group_photo" size="38" value="">
			                <div class="group_photo_preview" style="margin-bottom:10px;"><img src="/static/base/images/default.png" id="group_photo_preview" width="120"></div>
			                <a class="button bg-main button-small js-img-upload" data="group_photo" preview="group_photo_preview" href="javascript:;" >
			                	<span class="icon-upload"> 上传签约合同</span>
			                </a>
						</div>
					</div>
					<!-- <div class="form-group type3">
                        <div class="label">
                            <label>商户地址</label>
                        </div>
                        <div class="field">
                        	<div class="js-select-child" formlength="3" posturl="{:url('Region/getAjaxList')}" str="选择区域" formname="region_id" formvalue='' formstr="" notmsg='请选择地址'></div>
                        	<input type="text" class="input type3 mt5" name="address" size="60" value="">
                        </div>
                    </div> -->
                    <div class="form-group hidetype3 hide">
                        <div class="label">
                            <label>负责区域*</label>
                        </div>
                        <div class="field">
                        	<div class="js-select-child" formlength="2" posturl="{:url('Region/getAjaxList')}" str="选择区域" formname="region_id" formvalue='' formstr="" validtype='*' notmsg='请选择负责区域'></div>
                        </div>
                    </div>
				</div>
            	<div class="tab-panel" id="tab-3">
                    <div class="form-group">
                        <div class="label">
                            <label>手机号码</label>
                        </div>
                        <div class="field">
                            <input type="text" class="input" id="phone" name="phone" size="40" datatype="*" value="">
                            <div class="input-note">注册成功后即可使用手机号登录</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>验证码</label>
                        </div>
                        <div class="field">
                            <input type="text" class="input" id="code" name="code" size="12" datatype="*" value="">
                            <a id="sendcode" class="input" href="javascript:;">获取验证码</a>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>设置密码</label>
                        </div>
                        <div class="field">
                            <input type="password" class="input" id="password" name="password" size="40" datatype="*" value="">
                            <div class="input-note">(长度在5~20之间，只能包含字母、数字和下划线)</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label>重复密码</label>
                        </div>
                        <div class="field">
                            <input type="password" class="input" id="repassword" name="repassword" size="40" datatype="*" value="">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="label">
                            <label></label>
                        </div>
                        <div class="field">
                            <input type="checkbox" id="allow" name="allow">同意用户协议
                        </div>
                    </div>
				</div>
            </div>
            <div class="panel-foot">
                <div class="form-button">
                	<input type="hidden" name="step" value="1">
                	<a id="prev" class="input bg-gray hide" style="display: none;" href="javascript:;">上一步</a>
                	<a id="next" class="input bg-main" href="javascript:;">下一步</a>
                	<a id="post" class="input bg-main" style="display: none;" href="javascript:;">提交</a>
                    <!-- <button id="submit" class="button bg-main" style="display: none;" disabled="disabled" type="submit">提交</button> -->
                    <div id="tips"></div>
                </div>
            </div>
        </div>
    </div>
</form>
<script>
	var store_name = '零售商';
	var step = 1;
	var type = 3;
	$('#prev').click(function(){
		skip(0);
	});
	$("#sendcode").click(function(){
		var phone 		= $("#phone").val().trim();
		if(!phone){
			layer.msg('手机号不能为空');
			return false;
		}
		$.post('{:url("merchant/sendcode", ["store_no" => $store_no])}', {phone: phone}, function(data){
			if(data.code == 0){
				layer.msg(data.msg);
			}else{
				layer.msg(data.msg, {icon: 1});
			}
		});
		return false;
    });
	$('#next, #post').click(function(){
		switch(step){
			case 1:
				var stype = $('input[name="type"]:checked').val();
				if(!stype){
					layer.msg('请选择入驻商户类型');
					return false;
				}
				skip(1);
				return false;
			break;
			case 2:
				var name 		= $("#name").val().trim();
				var user_name 	= $("#user_name").val().trim();
				var channel_no 	= $("#channel_no").val().trim();
				var region_id 	= $("#region_id").val().trim();
				var region_name = $("#region_name").val().trim();
				if(!name){
					layer.msg(store_name+'名称不能为空');
					return false;
				}
				if(!user_name){
					layer.msg('联系人姓名不能为空');
					return false;
				}
				if(type == 3 && !channel_no){
					layer.msg('渠道商编号不能为空');
					return false;
				}
				if(type != 3 && (!region_id || !region_name)){
					layer.msg('请选择负责区域');
					return false;
				}
				if(type == 3){
					var url = window.location.href + '?step=' + step;
					$.post(url, {type:type, channel_no: channel_no, name:name, user_name: user_name}, function(data){
						console.log(data);
						if(data.code == 0){
							layer.msg(data.msg);
						}else{
							skip(1);
						}
					});
					return false;
				}else{
					skip(1);
					return false;
				}
			break;
			case 3:
				var phone 		= $("#phone").val().trim();
				var code 		= $("#code").val().trim();
				var password 	= $("#password").val().trim();
				var repassword 	= $("#repassword").val().trim();
				var allow		= $("#allow").is(':checked');
				if(!phone){
					layer.msg('手机号不能为空');
					return false;
				}
				if(!code){
					layer.msg('验证码不能为空');
					return false;
				}
				if(!password){
					layer.msg('密码不能为空');
					return false;
				}
				if(password != repassword){
					layer.msg('两次密码输入不一致');
					return false;
				}
				if(!allow){
					layer.msg('请同意用户协议');
					return false;
				}
				step ++;
				$('#form').submit();
			break;
		}
	});
    $("input[name='type']").change(function(){
    	type = $(this).val().trim();
    	store_name = $(this).next('span').html();
    	if(type != 3){
    		$('.type3').hide();
    		$('.hidetype3').show();
    	}else{
    		$('.type3').show();
    		$('.hidetype3').hide();
    	}
    	$('#merchant_type').html(store_name);
    });
    function skip(flag = 0)
	{
		step = flag > 0 ? step+1 : step-1;
		if(step <= 0){
			step = 1;
		}else if(step > 3){
			step = 3;
		}
		if(step > 1){
			$('#prev').show();
		}else{
			$('#prev').hide();
		}
		if(step == 3){
			$('#next').hide();
			$("#post").show();
		}else{
			$('#next').show();
			$("#post").hide();
		}
		$('.tab-'+step).click();
		$('input[name="step"]').val(step);
	}
    Do.ready('base', function () {
        //表单综合处理
        $('#form').FormPage({
        	'uploadUrl' : "{:url('Upload/upload', ['prex' => 'store_profile_', 'thumb_type' => 'profile_thumb_500'])}",
        });
    }); 
</script>